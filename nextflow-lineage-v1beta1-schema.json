{
    "$id": "https://nextflow.io/schemas/lineage/v1beta1/lineage-schema.json",
    "title": "Nextflow Lineage Data Model v1beta1",
    "description": "JSON Schema for Nextflow lineage data model version v1beta1. This schema validates data lineage information produced by Nextflow workflows including checksums, file paths, task runs, workflow runs, and their relationships.",
    "type": "object",
    "definitions": {
        "Checksum": {
            "type": "object",
            "title": "Checksum",
            "description": "Models a checksum including the value as well as the algorithm and mode used to compute it",
            "properties": {
                "value": {
                    "type": "string",
                    "pattern": "^[a-fA-F0-9]+$",
                    "minLength": 1,
                    "description": "The checksum value as a hexadecimal string",
                    "examples": [
                        "a1b2c3d4e5f6",
                        "1234567890abcdef"
                    ]
                },
                "algorithm": {
                    "type": "string",
                    "enum": [
                        "nextflow"
                    ],
                    "description": "The algorithm used to compute the checksum. Currently only 'nextflow' is supported."
                },
                "mode": {
                    "type": "string",
                    "enum": [
                        "standard",
                        "deep",
                        "lenient",
                        "sha256"
                    ],
                    "description": "The hashing mode used to compute the checksum",
                    "examples": [
                        "standard",
                        "deep",
                        "lenient",
                        "sha256"
                    ]
                }
            },
            "required": [
                "value",
                "algorithm",
                "mode"
            ],
            "additionalProperties": false
        },
        "DataPath": {
            "type": "object",
            "title": "DataPath",
            "description": "Models a data path which includes the path and a checksum to validate the content of the path",
            "properties": {
                "path": {
                    "type": "string",
                    "format": "uri",
                    "description": "Real path of the data as a URI (file://, s3://, etc.)",
                    "examples": [
                        "file:///path/to/script.nf",
                        "file:///path/to/input.txt"
                    ]
                },
                "checksum": {
                    "$ref": "#/definitions/Checksum",
                    "description": "Checksum of the data content"
                }
            },
            "required": [
                "path",
                "checksum"
            ],
            "additionalProperties": false
        },
        "Parameter": {
            "type": "object",
            "title": "Parameter",
            "description": "Model Workflow and Task Parameters including input/output channels and environment variables",
            "properties": {
                "type": {
                    "type": "string",
                    "enum": [
                        "stdout",
                        "stdin",
                        "path",
                        "val",
                        "env",
                        "eval",
                        "each",
                        "Path",
                        "String",
                        "Collection",
                        "Map"
                    ],
                    "description": "The parameter type - one of the supported Nextflow parameter types",
                    "examples": [
                        "path",
                        "val",
                        "env",
                        "String",
                        "Collection"
                    ]
                },
                "name": {
                    "type": "string",
                    "pattern": "^[a-zA-Z_][a-zA-Z0-9_]*$",
                    "minLength": 1,
                    "description": "The parameter name - must be a valid identifier",
                    "examples": [
                        "input_file",
                        "output_dir",
                        "threads",
                        "sample_id"
                    ]
                },
                "value": {
                    "title": "Parameter Value",
                    "description": "The parameter value - can be any type depending on the parameter type. For 'path' types, may contain file paths or lid:// URIs. For 'val' types, contains primitive values.",
                    "examples": [
                        "file:///path/to/input.txt",
                        "lid://abc123/output.txt",
                        42,
                        "sample_name",
                        [
                            "item1",
                            "item2"
                        ]
                    ]
                }
            },
            "required": [
                "type",
                "name",
                "value"
            ],
            "additionalProperties": false
        },
        "FileOutput": {
            "type": "object",
            "title": "FileOutput",
            "description": "Model a base class for workflow and task outputs representing real files with metadata",
            "properties": {
                "path": {
                    "type": "string",
                    "format": "uri",
                    "description": "Real path of the output data as a URI (file://, s3://, etc.)",
                    "examples": [
                        "file:///path/to/output.txt",
                        "s3://bucket/output.txt"
                    ]
                },
                "checksum": {
                    "$ref": "#/definitions/Checksum",
                    "description": "Checksum of the output data"
                },
                "source": {
                    "type": "string",
                    "pattern": "^lid://[a-fA-F0-9]+(/.*)?$",
                    "description": "Entity that generated the data - lid:// URI referencing FileOutput, TaskRun, or WorkflowRun",
                    "examples": [
                        "lid://1234567890abcdef",
                        "lid://abc123/output.txt"
                    ]
                },
                "workflowRun": {
                    "type": "string",
                    "pattern": "^lid://[a-fA-F0-9]+$",
                    "description": "Reference to the WorkflowRun that generated the data - lid:// URI",
                    "examples": [
                        "lid://1234567890abcdef"
                    ]
                },
                "taskRun": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "pattern": "^lid://[a-fA-F0-9]+$",
                    "description": "Reference to the task that generated the data - lid:// URI (null for workflow-level outputs)",
                    "examples": [
                        "lid://abc123def456",
                        null
                    ]
                },
                "size": {
                    "type": "integer",
                    "minimum": 0,
                    "description": "Size of the data"
                },
                "createdAt": {
                    "type": "string",
                    "format": "date-time",
                    "description": "Data creation date (ISO 8601 format)"
                },
                "modifiedAt": {
                    "type": "string",
                    "format": "date-time",
                    "description": "Data last modified date (ISO 8601 format)"
                },
                "labels": {
                    "type": "array",
                    "title": "Labels",
                    "items": {
                        "type": "string",
                        "title": "Label"
                    },
                    "description": "Labels attached to the data"
                }
            },
            "required": [
                "path",
                "checksum",
                "source",
                "workflowRun",
                "size",
                "createdAt",
                "modifiedAt"
            ],
            "additionalProperties": false
        },
        "TaskOutput": {
            "type": "object",
            "title": "TaskOutput",
            "description": "Models task results",
            "properties": {
                "taskRun": {
                    "type": "string",
                    "description": "Reference to the task that generated the output"
                },
                "workflowRun": {
                    "type": "string",
                    "description": "Reference to the WorkflowRun that generated the output"
                },
                "createdAt": {
                    "type": "string",
                    "format": "date-time",
                    "description": "Creation date of this task output description (ISO 8601 format)"
                },
                "output": {
                    "type": "array",
                    "title": "Task Output Parameters",
                    "items": {
                        "$ref": "#/definitions/Parameter"
                    },
                    "description": "Output of the task"
                },
                "labels": {
                    "type": "array",
                    "title": "Task Output Labels",
                    "items": {
                        "type": "string",
                        "title": "Label"
                    },
                    "description": "Labels attached to the task output"
                }
            },
            "required": [
                "taskRun",
                "workflowRun",
                "createdAt",
                "output"
            ],
            "additionalProperties": false
        },
        "TaskRun": {
            "type": "object",
            "title": "TaskRun",
            "description": "Models a task execution including code, environment, and execution context",
            "properties": {
                "sessionId": {
                    "type": "string",
                    "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$",
                    "description": "Execution session identifier - UUID format",
                    "examples": [
                        "550e8400-e29b-41d4-a716-446655440000"
                    ]
                },
                "name": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Task name as defined in the workflow",
                    "examples": [
                        "FASTQC",
                        "BWA_MEM",
                        "SAMTOOLS_SORT"
                    ]
                },
                "codeChecksum": {
                    "$ref": "#/definitions/Checksum",
                    "description": "Checksum of the task source code"
                },
                "script": {
                    "type": "string",
                    "description": "Resolved task script"
                },
                "input": {
                    "type": "array",
                    "title": "Task Input Parameters",
                    "items": {
                        "$ref": "#/definitions/Parameter"
                    },
                    "description": "Task run input"
                },
                "container": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "description": "Container used for the task run"
                },
                "conda": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "description": "Conda environment used for the task run"
                },
                "spack": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "description": "Spack environment used for the task run"
                },
                "architecture": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "description": "Architecture defined in the Spack environment used for the task run"
                },
                "globalVars": {
                    "type": "object",
                    "title": "Global Variables",
                    "description": "Global variables defined in the task run"
                },
                "binEntries": {
                    "type": "array",
                    "title": "Binary Entries",
                    "items": {
                        "$ref": "#/definitions/DataPath"
                    },
                    "description": "Binaries used in the task run"
                },
                "workflowRun": {
                    "type": "string",
                    "description": "Workflow run associated to the task run"
                }
            },
            "required": [
                "sessionId",
                "name",
                "codeChecksum",
                "script",
                "input",
                "workflowRun"
            ],
            "additionalProperties": false
        },
        "Workflow": {
            "type": "object",
            "title": "Workflow",
            "description": "Models a workflow definition including source code and version control information",
            "properties": {
                "scriptFiles": {
                    "type": "array",
                    "title": "Script Files",
                    "items": {
                        "$ref": "#/definitions/DataPath"
                    },
                    "minItems": 1,
                    "description": "List of script files defining a workflow (main script and modules)",
                    "examples": [
                        [
                            {
                                "path": "file:///path/to/main.nf",
                                "checksum": {
                                    "value": "abc123",
                                    "algorithm": "nextflow",
                                    "mode": "standard"
                                }
                            }
                        ]
                    ]
                },
                "repository": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "format": "uri",
                    "description": "Workflow repository URL (git, github, etc.) or null if local",
                    "examples": [
                        "https://github.com/user/workflow.git",
                        null
                    ]
                },
                "commitId": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "pattern": "^[a-fA-F0-9]{6,40}$",
                    "description": "Git commit identifier (SHA) or null if not from a repository",
                    "examples": [
                        "a1b2c3d4e5f6789",
                        "1234567890abcdef1234567890abcdef12345678",
                        null
                    ]
                }
            },
            "required": [
                "scriptFiles"
            ],
            "additionalProperties": false
        },
        "WorkflowOutput": {
            "type": "object",
            "title": "WorkflowOutput",
            "description": "Models the results of a workflow execution",
            "properties": {
                "createdAt": {
                    "type": "string",
                    "format": "date-time",
                    "description": "Creation date of the workflow output (ISO 8601 format)"
                },
                "workflowRun": {
                    "type": "string",
                    "description": "Workflow run that generated the output"
                },
                "output": {
                    "type": "array",
                    "title": "Workflow Output Parameters",
                    "items": {
                        "$ref": "#/definitions/Parameter"
                    },
                    "description": "Workflow output"
                }
            },
            "required": [
                "createdAt",
                "workflowRun",
                "output"
            ],
            "additionalProperties": false
        },
        "WorkflowRun": {
            "type": "object",
            "title": "WorkflowRun",
            "description": "Models a Workflow Execution including the workflow definition, runtime parameters, and configuration",
            "properties": {
                "workflow": {
                    "$ref": "#/definitions/Workflow",
                    "description": "Workflow definition including script files and repository information"
                },
                "sessionId": {
                    "type": "string",
                    "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$",
                    "description": "Execution session identifier - UUID format",
                    "examples": [
                        "550e8400-e29b-41d4-a716-446655440000"
                    ]
                },
                "name": {
                    "type": "string",
                    "minLength": 1,
                    "description": "Workflow run name - often auto-generated or user-provided",
                    "examples": [
                        "silly_darwin",
                        "user_analysis_run",
                        "my-workflow-2024"
                    ]
                },
                "params": {
                    "type": "array",
                    "title": "Workflow Parameters",
                    "items": {
                        "$ref": "#/definitions/Parameter"
                    },
                    "description": "Workflow parameters"
                },
                "config": {
                    "type": "object",
                    "title": "Configuration",
                    "description": "Resolved Configuration"
                }
            },
            "required": [
                "workflow",
                "sessionId",
                "name",
                "params",
                "config"
            ],
            "additionalProperties": false
        }
    },
    "oneOf": [
        {
            "title": "Single Workflow Run",
            "description": "Single workflow run lineage data",
            "allOf": [
                {
                    "$ref": "#/definitions/WorkflowRun"
                },
                {
                    "properties": {
                        "version": {
                            "type": "string",
                            "const": "lineage/v1beta1",
                            "description": "Lineage model version identifier - must be 'lineage/v1beta1'",
                            "examples": [
                                "lineage/v1beta1"
                            ]
                        }
                    },
                    "required": [
                        "version"
                    ]
                }
            ]
        },
        {
            "title": "Multiple Workflow Runs",
            "description": "Multiple workflow runs lineage data",
            "type": "object",
            "properties": {
                "version": {
                    "type": "string",
                    "const": "lineage/v1beta1",
                    "description": "Lineage model version identifier - must be 'lineage/v1beta1'",
                    "examples": [
                        "lineage/v1beta1"
                    ]
                },
                "workflowRuns": {
                    "type": "array",
                    "title": "Workflow Runs Collection",
                    "items": {
                        "$ref": "#/definitions/WorkflowRun"
                    },
                    "minItems": 1,
                    "description": "Collection of workflow execution instances with their parameters and configurations",
                    "examples": [
                        [
                            {
                                "workflow": {
                                    "scriptFiles": [
                                        {
                                            "path": "file:///path/to/main.nf",
                                            "checksum": {
                                                "value": "abc123",
                                                "algorithm": "nextflow",
                                                "mode": "standard"
                                            }
                                        }
                                    ]
                                },
                                "sessionId": "550e8400-e29b-41d4-a716-446655440000",
                                "name": "workflow_run_1",
                                "params": [],
                                "config": {}
                            }
                        ]
                    ]
                }
            },
            "required": [
                "version",
                "workflowRuns"
            ],
            "additionalProperties": false
        }
    ]
}
